<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Voice Search</title>
  <!-- Font Awesome for microphone icon -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
    /* Some basic styling for the microphone button */
    button {
      border: none;
      background: none;
      cursor: pointer;
      outline: none;
    }
  </style>
</head>
<body>
  <div class="info"></div>
  <form id="search-form" action="/search" method="GET">
    <input type="text" name="query" placeholder="Search..." required>
  </form>

  <script>
    const searchForm = document.querySelector("#search-form");
    const searchFormInput = searchForm.querySelector("input");
    const info = document.querySelector(".info");

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    if(SpeechRecognition) {
      const recognition = new SpeechRecognition();
      recognition.continuous = true;

      searchForm.insertAdjacentHTML("beforeend", '<button type="button"><i class="fas fa-microphone"></i></button>');
      searchFormInput.style.paddingRight = "50px";

      const micBtn = searchForm.querySelector("button");
      const micIcon = micBtn.firstElementChild;

      micBtn.addEventListener("click", micBtnClick);
      function micBtnClick() {
        if(micIcon.classList.contains("fa-microphone")) {
          recognition.start();
        }
        else {
          recognition.stop();
        }
      }

      recognition.addEventListener("start", startSpeechRecognition);
      function startSpeechRecognition() {
        micIcon.classList.remove("fa-microphone");
        micIcon.classList.add("fa-microphone-slash");
        searchFormInput.focus();
        console.log("Voice activated, SPEAK");
      }

      recognition.addEventListener("end", endSpeechRecognition);
      function endSpeechRecognition() {
        micIcon.classList.remove("fa-microphone-slash");
        micIcon.classList.add("fa-microphone");
        searchFormInput.focus();
        console.log("Speech recognition service disconnected");
      }

      recognition.addEventListener("result", resultOfSpeechRecognition);
      function resultOfSpeechRecognition(event) {
        const current = event.resultIndex;
        const transcript = event.results[current][0].transcript;
        
        if(transcript.toLowerCase().trim()==="stop recording") {
          recognition.stop();
        }
        else if(!searchFormInput.value) {
          searchFormInput.value = transcript;
        }
        else {
          if(transcript.toLowerCase().trim()==="go") {
            searchForm.submit();
          }
          else if(transcript.toLowerCase().trim()==="reset input") {
            searchFormInput.value = "";
          }
          else {
            searchFormInput.value = transcript;
          }
        }
      }
      
      info.textContent = 'Voice Commands: "stop recording", "reset input", "go"';
      
    }
    else {
      console.log("Your Browser does not support speech Recognition");
      info.textContent = "Your Browser does not support Speech Recognition";
    } 
  </script>
</body>
</html>
